<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lịch Học — Phiên bản nâng cấp với Quản lý khung giờ</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root{
            --bg1:#1a2a6c; --bg2:#b21f1f; --bg3:#fdbb2d; --card:#ffffff; --muted:#6c757d;
            --current-cell: #ffeb3b; --current-border: #ff6b6b;
        }
        body.light{ background: linear-gradient(135deg,#e8f0ff 0%,#f8e7ee 50%,#fff7d6 100%); color:#222; }
        body.dark{ background: linear-gradient(135deg,#0f1724 0%,#2a2b38 50%,#1b2430 100%); color:#eee; }
        .container { max-width:1400px; margin:0 auto; width:100%; padding:20px; }
        header{ display:flex; gap:16px; align-items:center; justify-content:space-between; margin-bottom:14px; }
        h1{font-size:1.4rem}
        .controls{ display:flex; gap:8px; align-items:center; }
        .btn{ padding:8px 10px; border-radius:8px; border:0; cursor:pointer; font-weight:700; }
        .btn.ghost{ background:transparent; border:2px solid rgba(255,255,255,0.08); }
        .panel{ background:var(--card); border-radius:12px; padding:12px; box-shadow:0 8px 20px rgba(0,0,0,0.08); }
        .flex{ display:flex; gap:8px; align-items:center; }

        /* table */
        .week-schedule{ margin-top:12px; overflow:auto; border-radius:12px; }
        .week-table{ width:100%; border-collapse:collapse; min-width:980px; }
        .week-table th,.week-table td{ border:1px solid rgba(0,0,0,0.06); padding:8px; vertical-align:top; }
        .week-table th{ position:sticky; top:0; background:linear-gradient(90deg,var(--bg1),var(--bg2)); color:#fff; }
        .time-header{ position:sticky; left:0; background:rgba(0,0,0,0.06); font-weight:700; }
        .activity-item{ padding:8px; border-radius:8px; margin-bottom:6px; cursor:pointer; }
        .empty-cell{ min-height:60px; padding:8px; border-radius:8px; background:rgba(0,0,0,0.03); text-align:center; cursor:pointer; }

        /* current time highlight */
        .current-time-cell{ 
            background-color: var(--current-cell) !important; 
            position: relative;
            box-shadow: inset 0 0 0 2px var(--current-border);
            font-weight: 700;
        }

        /* categories default colors */
        .cat-math{ background:#ffeaa7; border-left:4px solid #fdcb6e; }
        .cat-it{ background:#d1ecf1; border-left:4px solid #0c5460; }
        .cat-english{ background:#d4edda; border-left:4px solid #28a745; }
        .cat-sleep{ background:#e3f2fd; border-left:4px solid #0d6efd; }
        .cat-break{ background:#f8d7da; border-left:4px solid #dc3545; }
        .cat-class{ background:#e2e3e5; border-left:4px solid #6c757d; }
        .cat-other{ background:#e9d8f2; border-left:4px solid #694489; }

        /* modal */
        .modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); align-items:center; justify-content:center; z-index:1200; }
        .modal .content{ background:var(--card); padding:14px; border-radius:10px; width:100%; max-width:520px; }
        .form-group{ margin-bottom:8px; }
        input,textarea,select{ width:100%; padding:8px; border-radius:6px; border:1px solid #ddd; }

        .toolbar{ display:flex; gap:8px; flex-wrap:wrap; }
        .search{ padding:8px; border-radius:8px; border:1px solid #ddd; min-width:220px; }

        .small{ font-size:0.86rem; padding:6px 8px; }

        .instructions{ margin-top:10px; padding:10px; border-radius:8px; background:linear-gradient(90deg,#fff7cc,#fff); }

        footer{ margin-top:12px; text-align:right; opacity:0.86; }

        @media(max-width:760px){ .controls{ flex-direction:column; align-items:flex-end } }
    </style>
</head>
<body class="light">
    <div class="container">
        <header>
            <div>
                <h1><i class="fas fa-calendar-alt"></i> Lịch Học — Nâng cấp</h1>
                <div class="small">Nhấp ô để thêm / sửa. Hỗ trợ import/export, tìm kiếm, nhắc nhở, share, QR.</div>
            </div>

            <div class="controls">
                <div class="toolbar panel">
                    <input id="searchInput" class="search" placeholder="Tìm tên/ghi chú..." oninput="renderWeeklySchedule()" />
                    <select id="filterCategory" class="small" onchange="renderWeeklySchedule()">
                        <option value="">— Lọc theo loại —</option>
                        <option value="math">Toán</option>
                        <option value="it">IT</option>
                        <option value="english">Tiếng Anh</option>
                        <option value="sleep">Ngủ</option>
                        <option value="break">Giải lao</option>
                        <option value="class">Lớp</option>
                        <option value="other">Khác</option>
                    </select>
                    <button class="btn" onclick="openImportModal()"><i class="fas fa-file-import"></i> Import</button>
                    <button class="btn" onclick="exportJSON()"><i class="fas fa-file-export"></i> Export JSON</button>
                    <button class="btn" onclick="exportCSV()"><i class="fas fa-table"></i> Export CSV</button>
                </div>

                <div class="panel flex">
                    <button id="themeToggle" class="btn" onclick="toggleTheme()"><i class="fas fa-adjust"></i> Theme</button>
                    <button id="syncToggleBtn" class="btn" onclick="toggleSync()"><i class="fas fa-cloud"></i> Sync</button>
                    <button id="reminderToggle" class="btn" onclick="toggleReminders()"><i class="fas fa-bell"></i> Nhắc</button>
                    <button class="btn" onclick="generateShareLink()"><i class="fas fa-share-alt"></i> Chia sẻ</button>
                </div>
            </div>
        </header>

        <div id="mainArea">
            <div class="instructions panel">
                <b>Nhập theo mẫu tự động:</b> Dán đoạn văn từng dòng 1, dạng <code>Thứ 2,8h-9h,math,Học chương 1</code> hoặc <code>8h-9h | Thứ 2 | Toán | Học chương 1</code>. Nhấn "Phân tích và Thêm".
            </div>

            <div style="margin-top:10px; display:flex; gap:12px; align-items:flex-start;">
                <div style="flex:1">
                    <div class="panel">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">
                            <strong>Lịch Tuần</strong>
                            <div class="small">(Chế độ: <span id="modeLabel">Chỉnh sửa</span>)</div>
                        </div>
                        <div class="week-schedule panel">
                            <table class="week-table">
                                <thead>
                                    <tr>
                                        <th class="time-header">Giờ</th>
                                        <th>Thứ 2</th>
                                        <th>Thứ 3</th>
                                        <th>Thứ 4</th>
                                        <th>Thứ 5</th>
                                        <th>Thứ 6</th>
                                        <th>Thứ 7</th>
                                        <th>Chủ nhật</th>
                                    </tr>
                                </thead>
                                <tbody id="scheduleBody">
                                    <!-- Các ô lịch sẽ được render bằng JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="panel" style="margin-top:12px">
                        <strong>Quản lý khung giờ cố định</strong>
                        <div id="timeSlotList" style="margin-top:8px;"></div>
                        <div style="margin-top:6px; display:flex; gap:4px;">
                            <input id="newSlot" placeholder="vd: 12:00-12:45" class="small"/>
                            <button class="btn small" onclick="addTimeSlot()">Thêm</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            &copy; 2025 Lịch Học Nâng cấp | Phiên bản demo
        </footer>
    </div>

    <script>
        // ===================== DỮ LIỆU =====================
        let TIME_SLOTS = ["7:00-7:45","7:45-8:30","8:30-9:15","9:15-10:00","10:00-10:45","10:45-11:30","11:30-12:15","12:15-13:00","13:00-13:45","13:45-14:30","14:30-15:15","15:15-16:00"];
        let WEEK_DATA = { "Thứ 2": [], "Thứ 3": [], "Thứ 4": [], "Thứ 5": [], "Thứ 6": [], "Thứ 7": [], "Chủ nhật": [] };
        let CURRENT_THEME = "light";

        // ===================== KHUNG GIỜ =====================
        function loadTimeSlots(){
            const stored = localStorage.getItem('timeSlotsV2');
            if(stored){ TIME_SLOTS = JSON.parse(stored); }
        }

        function saveTimeSlots(){
            localStorage.setItem('timeSlotsV2', JSON.stringify(TIME_SLOTS));
        }

        function renderTimeSlotList(){
            const container = document.getElementById('timeSlotList');
            container.innerHTML = "";
            TIME_SLOTS.forEach((slot,i)=>{
                const div = document.createElement('div');
                div.style.display="flex"; div.style.justifyContent="space-between"; div.style.marginBottom="2px";
                div.innerHTML = `<span>${slot}</span><button class="btn small" onclick="removeTimeSlot(${i})"><i class="fas fa-trash"></i></button>`;
                container.appendChild(div);
            });
        }

        function addTimeSlot(){
            const val = document.getElementById('newSlot').value.trim();
            if(val && !TIME_SLOTS.includes(val)){
                TIME_SLOTS.push(val);
                saveTimeSlots(); renderTimeSlotList(); document.getElementById('newSlot').value="";
                renderWeeklySchedule();
            }
        }

        function removeTimeSlot(index){
            TIME_SLOTS.splice(index,1);
            saveTimeSlots(); renderTimeSlotList(); renderWeeklySchedule();
        }

        // ===================== LỊCH =====================
        function renderWeeklySchedule(){
            const tbody = document.getElementById('scheduleBody');
            tbody.innerHTML="";
            TIME_SLOTS.forEach(slot=>{
                const tr = document.createElement('tr');
                const th = document.createElement('th'); th.className="time-header"; th.innerText=slot; tr.appendChild(th);
                ["Thứ 2","Thứ 3","Thứ 4","Thứ 5","Thứ 6","Thứ 7","Chủ nhật"].forEach(day=>{
                    const td = document.createElement('td');
                    td.className="empty-cell";
                    const activities = WEEK_DATA[day].filter(act=>act.time===slot);
                    if(activities.length>0){
                        td.innerHTML = activities.map(a=>`<div class="activity-item cat-${a.category}">${a.name}</div>`).join("");
                    }
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
        }

        // ===================== THEME =====================
        function toggleTheme(){
            if(CURRENT_THEME==="light"){ document.body.className="dark"; CURRENT_THEME="dark"; }
            else { document.body.className="light"; CURRENT_THEME="light"; }
        }

        // ===================== INIT =====================
        loadTimeSlots();
        renderTimeSlotList();
        renderWeeklySchedule();
    </script>
</body>
</html>
